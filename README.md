# MassEmail.Net

Объясню как реализовал решения на след. требования:
A. Гарантированная отправка (сервис по отправке ответил, что сообщение отправлено)
B. Отправка должна быть гарантированно ОДНА.
C. Так как адресов много, нужно реализовать многопоточную отправку
D. Нужно предусмотреть отключение электричества. Имеется в виду, что после 
восстановления работоспособности сервиса, рассылка должна продолжиться, не 
нарушив требования.

Для реализации требований допольнительно использую брокер сообщений: RabbitMQ

Логика работы службы следующая:
1. Из хранилища(База данных, excel файл и т.д) получил список адресов эл. почты
2. Загрузил список адресов эл. почты в брокер сообщений (в данном случае Rabbit MQ, в очередь "CommonQueue")
Такой реализацией я хочу решить требование пункта B.
Если письмо отправлено, то из очереди сообщение (email) извлекается.
Если не отправлено, то в очереди сообщение (email) остается и последует повторная попытка отправки.
Считаю лучшим способом отправлять адреса эл.почты по которым не удалось произвести отправку письма в другую очередь ("ErrorQueue").

3. Из очереди "CommonQueue" получаю адреса и отправляю письма.
Логика этого пункта вызывается из проектов "MassEmail.Net.Publisher" и "MassEmail.Net.Consumer". 
Многопоточную отправку (пункт C) я реализовал возможностью запуска одновременно нескольких экземпляров проекта "MassEmail.Net.Consumer".

Реализация метода Send интерфейса IEmailDeliveryProvider возвращает переменную типа EmailSendingResult по которой можно понять сообщение было отправлено или нет (пунтк A)

4.Если отправка прошла успешно, то убираем из очереди "CommonQueue" адрес эл. почты.

Реализация пункта D:
При запуске службы идет проверка очереди "CommonQueue"
Если она не пустая, то по оставшимся адресам происходит рассылка писем.
Если пустая, то ничается шаг 1 описанный выше в этом руководстве
